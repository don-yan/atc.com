<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parallax Scrolling Effect with GSAP Timeline</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            min-height: 300vh;
            font-family: Arial, sans-serif;
        }

        #parallax-container {
            position: relative;
            width: 100%;
            min-height: 400px;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .parallax-layer {
            position: fixed;
            top: 50%;
            left: 50%;
            width: 60%;
            height: auto;
        }

        .layer0 {
            transform: translate(-50%, 50%); /* Start near the bottom */
            z-index: 1;
        }

        .layer1 {
            transform: translate(-50%, 30%); /* Slightly above layer0 */
            z-index: 2;
        }

        .layer2 {
            transform: translate(-50%, 10%); /* Slightly above layer1 */
            z-index: 3;
        }

        .layer3, .text-layer {
            transform: translate(-50%, 10%); /* Near the top */
            z-index: 4;
        }

        .buffer-div {
            background: #666;
            height: 200px;
            opacity: 50%;
        }
    </style>
</head>
<body>
<div class="buffer-div"></div>
<div id="parallax-container">
    <img src="assets/images/atc-arrow-layers/0-arrow - simple populate - bottom layer.png"
         class="parallax-layer parallax layer0" data-depth="0.40"/>
    <img src="assets/images/atc-arrow-layers/1-arrow - simple populate - middle layer.png"
         class="parallax-layer parallax layer1" data-depth="0.30"/>
    <img src="assets/images/atc-arrow-layers/2-arrow - simple populate - top layer - arrow only.png"
         class="parallax-layer parallax layer2" data-depth="0.20"/>
    <img src="assets/images/atc-arrow-layers/3-arrow - filled text only.png"
         class="parallax-layer parallax text-layer layer3" data-depth="0.20"/>
</div>
<div class="buffer-div"></div>

<!-- Include GSAP and ScrollTrigger -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>

<script>
    // Register ScrollTrigger with GSAP
    gsap.registerPlugin(ScrollTrigger);

    // Log to confirm GSAP and ScrollTrigger are loaded
    console.log("GSAP Loaded:", typeof gsap !== "undefined");
    console.log("ScrollTrigger Loaded:", typeof ScrollTrigger !== "undefined");

    // Convert percentage-based transforms to pixels for GSAP
    const viewportHeight = window.innerHeight;
    const initialY0 = 50 * viewportHeight / 100; // 50% of viewport height (downward)
    const initialY1 = 30 * viewportHeight / 100; // 30% of viewport height (downward)
    const initialY2 = 10 * viewportHeight / 100; // 10% of viewport height (downward)
    const initialYText = -10 * viewportHeight / 100; // -10% of viewport height (upward)

    // Define the convergence point (where all layers will end up)
    // We'll use the initial position of the text-layer (top-most layer) as the convergence point
    const convergenceY = initialYText; // All layers will converge to this y position

    // Create a GSAP timeline
    const tl = gsap.timeline({
        scrollTrigger: {
            trigger: "#parallax-container",
            start: "top center", // Start when the top of the container hits the center of the viewport
            end: "bottom top", // End when the bottom of the container hits the top of the viewport
            scrub: true, // Smoothly animate as the user scrolls
            markers: true, // Enable markers for debugging
            onEnter: () => console.log("Timeline animation started"),
            onLeave: () => console.log("Timeline animation ended")
        }
    });

    // Animate each layer to converge at the same y position
    gsap.utils.toArray(".parallax").forEach(layer => {
        const depth = parseFloat(layer.dataset.depth);
        const initialY = parseFloat(layer.style.transform.split(",")[1]) || 0; // Get initial y from CSS transform

        // Calculate the parallax movement based on depth
        const parallaxMovement = -(viewportHeight * depth); // Parallax effect based on depth

        // The final position will be the convergence point
        const finalY = convergenceY;

        // Add the animation to the timeline
        tl.to(layer, {
            y: finalY, // Converge to the same y position
            ease: "none",
            duration: 1 // Duration is relative to the scroll distance (scrubbed)
        }, 0); // Start all animations at the same time
    });

    window.addEventListener('scroll', function () {
        let scrollTop = window.scrollY;
        console.log({scrollTop});
    });
</script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9242597d5ead6741',t:'MTc0MjYxMTQ5MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>
</body>
</html>
